# AIæœåŠ¡é‡æž„æž¶æž„è®¾è®¡æ–‡æ¡£

## ðŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†Dispatch AIåŽç«¯AIæœåŠ¡çš„é‡æž„æž¶æž„è®¾è®¡ï¼Œæ—¨åœ¨æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

## ðŸŽ¯ é‡æž„ç›®æ ‡

### å½“å‰é—®é¢˜
1. **ä»£ç æ··æ‚**ï¼šä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®ã€å·¥å…·å‡½æ•°æ··åˆåœ¨åŒä¸€æ–‡ä»¶ä¸­
2. **èŒè´£ä¸æ¸…**ï¼š`chatr2v3.py`æ‰¿æ‹…äº†è¿‡å¤šè´£ä»»
3. **æµ‹è¯•å›°éš¾**ï¼šç¼ºä¹æ¸…æ™°çš„ä¾èµ–æ³¨å…¥å’Œåˆ†å±‚ç»“æž„
4. **æ‰©å±•æ€§å·®**ï¼šæ·»åŠ æ–°åŠŸèƒ½éœ€è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶
5. **é…ç½®åˆ†æ•£**ï¼šçŽ¯å¢ƒé…ç½®å’Œä¸šåŠ¡é…ç½®æ•£è½å„å¤„

### ç›®æ ‡æ•ˆæžœ
- âœ… **æ¸…æ™°çš„åˆ†å±‚æž¶æž„**ï¼šAPIã€æœåŠ¡ã€é¢†åŸŸã€åŸºç¡€è®¾æ–½å±‚åˆ†ç¦»
- âœ… **å•ä¸€èŒè´£åŽŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨äºŽç‰¹å®šåŠŸèƒ½
- âœ… **ä¾èµ–æ³¨å…¥**ï¼šä¾¿äºŽå•å…ƒæµ‹è¯•å’ŒåŠŸèƒ½æ›¿æ¢
- âœ… **é…ç½®é›†ä¸­åŒ–**ï¼šç»Ÿä¸€çš„é…ç½®ç®¡ç†
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°çš„å¯¹è¯æµç¨‹å’ŒAIåŠŸèƒ½

## ðŸ—ï¸ åˆ†å±‚æž¶æž„è®¾è®¡

### æž¶æž„ç†å¿µ

é‡‡ç”¨**Clean Architecture + DDD**è®¾è®¡ç†å¿µï¼š
- **ä¾èµ–å€’ç½®**ï¼šé«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½Žå±‚æ¨¡å—
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ¯å±‚ä¸“æ³¨äºŽç‰¹å®šèŒè´£
- **é¢†åŸŸé©±åŠ¨**ï¼šä»¥ä¸šåŠ¡é¢†åŸŸä¸ºæ ¸å¿ƒè®¾è®¡æ¨¡åž‹

### åˆ†å±‚ç»“æž„

```
ai/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                    # ðŸŒ APIå±‚ - å¤„ç†HTTPè¯·æ±‚/å“åº”
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py  # æ™ºèƒ½å¯¹è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py         # ç®€å•èŠå¤©è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ summary.py      # é€šè¯æ‘˜è¦è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ health.py       # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”‚   â””â”€â”€ dependencies.py     # ä¾èµ–æ³¨å…¥é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # âš™ï¸ æ ¸å¿ƒé…ç½®å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py          # ç»Ÿä¸€é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ security.py        # å®‰å…¨ç›¸å…³é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # ðŸ”§ ä¸šåŠ¡æœåŠ¡å±‚ - åº”ç”¨ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conversation_service.py  # å¯¹è¯ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ llm_service.py          # LLMäº¤äº’æœåŠ¡
â”‚   â”‚   â””â”€â”€ summary_service.py      # æ‘˜è¦ç”ŸæˆæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                # ðŸ’¼ é¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/            # é¢†åŸŸæ¨¡åž‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ call_session.py    # é€šè¯ä¼šè¯æ¨¡åž‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user_info.py       # ç”¨æˆ·ä¿¡æ¯æ¨¡åž‹
â”‚   â”‚   â”‚   â””â”€â”€ conversation.py    # å¯¹è¯æ¨¡åž‹
â”‚   â”‚   â””â”€â”€ workflows/         # ä¸šåŠ¡å·¥ä½œæµ
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ customer_info_workflow.py  # å®¢æˆ·ä¿¡æ¯æ”¶é›†å·¥ä½œæµ
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/        # ðŸ­ åŸºç¡€è®¾æ–½å±‚ - å¤–éƒ¨ä¾èµ–
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ redis_client.py    # Redisè¿žæŽ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ external/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ openai_client.py   # OpenAI APIå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ session_repository.py  # ä¼šè¯æ•°æ®ä»“å‚¨
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                 # ðŸ› ï¸ å·¥å…·å±‚ - é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ validators/        # æ•°æ®éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ contact_validators.py  # è”ç³»æ–¹å¼éªŒè¯
â”‚   â”‚   â”‚   â””â”€â”€ service_validators.py  # æœåŠ¡ç›¸å…³éªŒè¯
â”‚   â”‚   â”œâ”€â”€ prompts/          # æç¤ºè¯ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation_prompts.py  # å¯¹è¯æç¤ºè¯
â”‚   â”‚   â”‚   â””â”€â”€ extraction_prompts.py    # ä¿¡æ¯æå–æç¤ºè¯
â”‚   â”‚   â””â”€â”€ exceptions.py      # è‡ªå®šä¹‰å¼‚å¸¸å®šä¹‰
â”‚   â”‚
â”‚   â””â”€â”€ main.py               # ðŸš€ åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ tests/                    # ðŸ§ª æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ unit/                 # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/          # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/                  # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚
â”œâ”€â”€ scripts/                  # ðŸ“œ è„šæœ¬ç›®å½•
â”œâ”€â”€ docs/                     # ðŸ“š æ–‡æ¡£ç›®å½•
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Dockerfile.uat
â”œâ”€â”€ pyproject.toml
â””â”€â”€ Makefile
```

## ðŸŽ¯ å„å±‚èŒè´£è¯¦è§£

### 1. APIå±‚ (`api/`)
**èŒè´£**ï¼šå¤„ç†HTTPè¯·æ±‚å’Œå“åº”ï¼Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- è·¯ç”±å®šä¹‰å’Œå‚æ•°éªŒè¯
- è¯·æ±‚/å“åº”æ•°æ®è½¬æ¢
- HTTPçŠ¶æ€ç å’Œé”™è¯¯å¤„ç†
- APIæ–‡æ¡£ç”Ÿæˆ

**åŽŸåˆ™**ï¼š
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- åªè´Ÿè´£æ•°æ®ä¼ è¾“æ ¼å¼è½¬æ¢
- ä¾èµ–æ³¨å…¥ä¸šåŠ¡æœåŠ¡

### 2. æœåŠ¡å±‚ (`services/`)
**èŒè´£**ï¼šåº”ç”¨ä¸šåŠ¡é€»è¾‘åè°ƒï¼Œäº‹åŠ¡ç®¡ç†
- åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡å®Œæˆä¸šåŠ¡ç”¨ä¾‹
- å¤„ç†è·¨é¢†åŸŸçš„ä¸šåŠ¡æµç¨‹
- ç®¡ç†äº‹åŠ¡è¾¹ç•Œ
- è°ƒç”¨å¤–éƒ¨æœåŠ¡

**è®¾è®¡æ¨¡å¼**ï¼š
- åº”ç”¨æœåŠ¡æ¨¡å¼
- é—¨é¢æ¨¡å¼
- ç­–ç•¥æ¨¡å¼

### 3. é¢†åŸŸå±‚ (`domain/`)
**èŒè´£**ï¼šæ ¸å¿ƒä¸šåŠ¡è§„åˆ™å’Œé¢†åŸŸé€»è¾‘
- ä¸šåŠ¡å®žä½“å’Œå€¼å¯¹è±¡
- é¢†åŸŸæœåŠ¡å’Œä¸šåŠ¡è§„åˆ™
- å·¥ä½œæµçŠ¶æ€ç®¡ç†
- ä¸šåŠ¡ä¸å˜æ€§ç»´æŠ¤

**DDDæ¦‚å¿µ**ï¼š
- å®žä½“ (Entities)
- å€¼å¯¹è±¡ (Value Objects)
- é¢†åŸŸæœåŠ¡ (Domain Services)
- å·¥ä½œæµ (Workflows)

### 4. åŸºç¡€è®¾æ–½å±‚ (`infrastructure/`)
**èŒè´£**ï¼šå¤–éƒ¨ç³»ç»Ÿé›†æˆå’ŒæŠ€æœ¯å®žçŽ°
- æ•°æ®åº“è®¿é—®å®žçŽ°
- å¤–éƒ¨APIè°ƒç”¨
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- æ¶ˆæ¯é˜Ÿåˆ—ç­‰æŠ€æœ¯ç»†èŠ‚

**æ¨¡å¼**ï¼š
- ä»“å‚¨æ¨¡å¼ (Repository Pattern)
- é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
- å·¥åŽ‚æ¨¡å¼ (Factory Pattern)

### 5. å·¥å…·å±‚ (`utils/`)
**èŒè´£**ï¼šæä¾›é€šç”¨å·¥å…·å’Œè¾…åŠ©åŠŸèƒ½
- æ•°æ®éªŒè¯å·¥å…·
- å¸¸ç”¨å·¥å…·å‡½æ•°
- è‡ªå®šä¹‰å¼‚å¸¸
- é…ç½®è¾…åŠ©ç±»

## ðŸ“‹ é‡æž„å®žæ–½è®¡åˆ’

### Phase 1: åŸºç¡€æž¶æž„æ­å»º (é«˜ä¼˜å…ˆçº§)

#### 1.1 ç›®å½•ç»“æž„åˆ›å»º
```bash
# åˆ›å»ºæ–°çš„ç›®å½•ç»“æž„
mkdir -p app/{api/routers,core,services,domain/{models,workflows},infrastructure/{database,external,repositories},utils/{validators,prompts}}
mkdir -p tests/{unit,integration,e2e}
mkdir -p {scripts,docs}
```

#### 1.2 æ ¸å¿ƒé…ç½®é‡æž„
**ç›®æ ‡æ–‡ä»¶**: `app/core/config.py`
```python
# ç»Ÿä¸€é…ç½®ç®¡ç†
class Settings(BaseSettings):
    # Redisé…ç½®
    redis_host: str = "localhost"
    redis_port: int = 6379
    redis_db: int = 0
    
    # OpenAIé…ç½®
    openai_api_key: str
    openai_model: str = "gpt-4o"
    
    # åº”ç”¨é…ç½®
    debug: bool = False
    log_level: str = "INFO"
```

#### 1.3 æ•°æ®æ¨¡åž‹é‡æž„
**è¿ç§»**: `models.py` â†’ `domain/models/`
- æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æ¨¡åž‹æ–‡ä»¶
- æ·»åŠ é¢†åŸŸéªŒè¯é€»è¾‘
- å®žçŽ°æ•°æ®è½¬æ¢æ–¹æ³•

### Phase 2: æœåŠ¡å±‚é‡æž„ (é«˜ä¼˜å…ˆçº§)

#### 2.1 å¯¹è¯æœåŠ¡é‡æž„
**ç›®æ ‡**: å°†`chatr2v3.py`æ‹†åˆ†ä¸ºï¼š
- `services/conversation_service.py` - å¯¹è¯åè°ƒé€»è¾‘
- `domain/workflows/customer_info_workflow.py` - å·¥ä½œæµçŠ¶æ€ç®¡ç†
- `infrastructure/repositories/session_repository.py` - æ•°æ®è®¿é—®

#### 2.2 LLMæœåŠ¡é‡æž„
**ç›®æ ‡**: ä¼˜åŒ–`services/llm.py`
- ç»Ÿä¸€LLMæŽ¥å£å°è£…
- æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- æ”¯æŒå¤šç§LLMæä¾›å•†

### Phase 3: åŸºç¡€è®¾æ–½é‡æž„ (ä¸­ä¼˜å…ˆçº§)

#### 3.1 æ•°æ®è®¿é—®å±‚é‡æž„
**ç›®æ ‡**: é‡æž„`redis_client.py`
- å®žçŽ°ä»“å‚¨æ¨¡å¼
- æ·»åŠ è¿žæŽ¥æ± ç®¡ç†
- ç»Ÿä¸€é”™è¯¯å¤„ç†

#### 3.2 å¤–éƒ¨æœåŠ¡é›†æˆ
- OpenAIå®¢æˆ·ç«¯å°è£…
- ç»Ÿä¸€çš„HTTPå®¢æˆ·ç«¯
- é…ç½®é©±åŠ¨çš„æœåŠ¡å‘çŽ°

### Phase 4: æµ‹è¯•å’Œæ–‡æ¡£ (ä½Žä¼˜å…ˆçº§)

#### 4.1 æµ‹è¯•ä½“ç³»å»ºè®¾
- å•å…ƒæµ‹è¯•è¦†ç›–çŽ‡ > 80%
- é›†æˆæµ‹è¯•å…³é”®æµç¨‹
- E2Eæµ‹è¯•å®Œæ•´ç”¨ä¾‹

#### 4.2 æ–‡æ¡£å®Œå–„
- APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- æž¶æž„è®¾è®¡æ–‡æ¡£
- éƒ¨ç½²å’Œè¿ç»´æ–‡æ¡£

## ðŸ”§ è¿ç§»ç­–ç•¥

### æ¸è¿›å¼è¿ç§»
1. **æ–°åŠŸèƒ½æ–°æž¶æž„**ï¼šæ–°å¼€å‘çš„åŠŸèƒ½ä½¿ç”¨æ–°æž¶æž„
2. **é€æ­¥é‡æž„**ï¼šæŒ‰æ¨¡å—é€æ­¥è¿ç§»çŽ°æœ‰ä»£ç 
3. **å…¼å®¹æ€§ä¿è¯**ï¼šè¿ç§»æœŸé—´ä¿æŒAPIå…¼å®¹æ€§
4. **æµ‹è¯•å…ˆè¡Œ**ï¼šæ¯æ¬¡è¿ç§»å‰ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### é£Žé™©æŽ§åˆ¶
- **å›žæ»šæœºåˆ¶**ï¼šä¿ç•™åŽŸæœ‰ä»£ç åˆ†æ”¯
- **ç°åº¦å‘å¸ƒ**ï¼šåˆ†é˜¶æ®µéƒ¨ç½²éªŒè¯
- **ç›‘æŽ§å‘Šè­¦**ï¼šå®žæ—¶ç›‘æŽ§ç³»ç»Ÿç¨³å®šæ€§
- **æ–‡æ¡£æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

## ðŸ“Š æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç å¤ç”¨çŽ‡** > 70%
- **æµ‹è¯•è¦†ç›–çŽ‡** > 80%
- **æž„å»ºæ—¶é—´** < 2åˆ†é’Ÿ
- **å¹³å‡å“åº”æ—¶é—´** < 500ms

### å¼€å‘æ•ˆçŽ‡æŒ‡æ ‡
- **æ–°åŠŸèƒ½å¼€å‘æ—¶é—´**å‡å°‘ 30%
- **Bugä¿®å¤æ—¶é—´**å‡å°‘ 50%
- **ä»£ç å®¡æŸ¥æ—¶é—´**å‡å°‘ 40%

### è´¨é‡æŒ‡æ ‡
- **ä»£ç é‡å¤çŽ‡** < 5%
- **åœˆå¤æ‚åº¦** < 10
- **æŠ€æœ¯å€ºåŠ¡**å‡å°‘ 60%

## ðŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨é¡¹
1. **åˆ›å»ºåˆ†æ”¯**ï¼š`refactor/ai-architecture-phase1`
2. **æ­å»ºç›®å½•ç»“æž„**ï¼šæŒ‰ç…§è®¾è®¡åˆ›å»ºæ–‡ä»¶å¤¹
3. **è¿ç§»æ ¸å¿ƒé…ç½®**ï¼šå®žçŽ°ç»Ÿä¸€é…ç½®ç®¡ç†
4. **é‡æž„æ•°æ®æ¨¡åž‹**ï¼šæ‹†åˆ†`models.py`

### æœ¬å‘¨ç›®æ ‡
- [ ] å®ŒæˆPhase 1.1-1.3
- [ ] ç¼–å†™è¿ç§»è„šæœ¬
- [ ] æ›´æ–°CI/CDé…ç½®
- [ ] å›¢é˜ŸæŠ€æœ¯åˆ†äº«

### æœ¬æœˆç›®æ ‡
- [ ] å®ŒæˆPhase 2 æœåŠ¡å±‚é‡æž„
- [ ] å»ºç«‹æµ‹è¯•æ¡†æž¶
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] æ–‡æ¡£å®Œå–„

---

## ðŸ“ž è”ç³»æ–¹å¼

å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š
- **æž¶æž„è´Ÿè´£äºº**ï¼šå¼€å‘å›¢é˜Ÿ
- **é¡¹ç›®ç»ç†**ï¼šé¡¹ç›®ç»„
- **æŠ€æœ¯æ”¯æŒ**ï¼šDevOpså›¢é˜Ÿ

---
*æœ€åŽæ›´æ–°ï¼š2025-07-08*
*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*